# Signal Generator App

## Описание

Desktop-приложение, разработанное на C# с использованием WPF, позволяющее генерировать, визуализировать, сохранять и просматривать различные типы сигналов. Приложение реализует тестовое задание для ООО НПП ТИК.

## Функциональные возможности

*   **Генерация сигналов:**
    *   Синусоида (амплитуда, частота, фаза, количество точек)
    *   Меандр (амплитуда, частота, количество точек)
    *   Треугольный сигнал (амплитуда, частота, количество точек)
    *   Пилообразный сигнал (амплитуда, частота, количество точок)
    *   Возможность задания временного интервала генерации.
    *   Возможность задать количество точек при генерации.
    *   Добавление шума (гауссовский шум) к сигналу (уровень шума в процентах).
*   **Хранение данных:**
    *   Сохранение сгенерированных сигналов в локальную базу данных SQLite.
    *   Структура БД включает метаданные сигнала и его точки.
    *   Возможность загрузки ранее сохранённых сигналов.
    *   История сгенерированных/сохранённых сигналов с возможностью просмотра и выбора.
    *   Возможность удаления сигналов из истории.
*   **Визуализация:**
    *   Отображение графика сигнала в реальном времени после генерации с использованием библиотеки LiveCharts.
    *   Возможность масштабирования и сброса масштаба графика.
    *   Отображение параметров текущего сигнала.
    *   Кастомный tooltip при наведении на график.
*   **Интерфейс:**
    *   Понятный интерфейс на WPF.
    *   Форма ввода параметров генерации с валидацией.
    *   Область визуализации графика.
    *   Список сохранённых сигналов.
    *   Кнопки управления ("Генерировать", "Сохранить", "Загрузить", "Очистить", "Применить медианный фильтр", "Экспорт в PNG").
*   **Дополнительные возможности:**
    *   Unit-тесты для логики генерации сигналов.
    *   Применение медианного фильтра (размеры окна 3, 5, 7, или произвольное нечетное) к сигналу.
    *   Экспорт графика в изображение (PNG).

## Технические требования

*   **Язык:** C# (.NET 9)
*   **UI:** WPF
*   **База данных:** SQLite
*   **Библиотека графиков:** LiveChartsCore

## Зависимости

*   `CommunityToolkit.Mvvm` (для реализации MVVM)
*   `LiveChartsCore.SkiaSharpView.WPF` (для визуализации)
*   `Microsoft.Data.Sqlite` (для работы с SQLite)
*   `Microsoft.Extensions.DependencyInjection` (для внедрения зависимостей)
*   `FluentValidation` (для валидации)
*   `SkiaSharp` (для экспорта изображений и визуализации)
*   `Moq` (для тестирования)
*   `Microsoft.Extensions.Configuration` (для конфигурации)

## Архитектурные особенности

*   **MVVM (Model-View-ViewModel):** Основной паттерн архитектуры, разделяющий UI (View) от бизнес-логики (Model) и логики представления (ViewModel). Это улучшает тестируемость, читаемость и поддержку кода.
*   **Внедрение зависимостей (DI):** Используется `Microsoft.Extensions.DependencyInjection` для управления зависимостями между классами, что делает код более гибким, модульным и легко тестируемым.
*   **Паттерн "Стратегия" (Strategy):** Реализован для генерации различных типов сигналов (см. `ISignalGenerationStrategy` и его реализации). Это позволяет легко добавлять новые типы сигналов, не изменяя основной код генератора.
*   **Асинхронность (async/await):** Операции, требующие значительного времени (генерация, сохранение, загрузка, фильтрация), выполняются асинхронно, предотвращая блокировку пользовательского интерфейса. Используется `CancellationToken` для возможности отмены длительных операций.
*   **Валидация:** Валидация параметров генерации реализована с использованием `FluentValidation` и `INotifyDataErrorInfo`, обеспечивая корректный ввод данных.
*   **Использование пулов (`ArrayPool<T>`):** При применении медианного фильтра используется `ArrayPool<double>` для повторного использования буферов, снижая давление на сборщик мусора (GC) при обработке больших сигналов.
*   **Модульное тестирование:** Используются `xUnit` и `Moq` для тестирования логики генерации сигналов и других компонентов.

## Алгоритмы

*   **Генерация сигналов:**
    *   **Синусоида:** `y(t) = A * sin(2πft + φ)`, где `A` - амплитуда, `f` - частота, `t` - время, `φ` - фаза.
    *   **Меандр:** `y(t) = A * sign(sin(2πft))`.
    *   **Треугольник:** Линейный рост от `-A` до `+A` за полупериод, затем линейное падение обратно до `-A`.
    *   **Пилообразный:** Линейный рост от `-A` до `+A` за весь период.
    *   **Шум:** Генерируется отдельно (гауссовский шум) и добавляется к каждому значению "чистого" сигнала. Амплитуда шума вычисляется как процент от амплитуды исходного сигнала.
*   **Медианный фильтр:**
    *   Для окон размером 3, 5, 7: Используется `stackalloc` для выделения буфера в стеке и сортировка вставками для нахождения медианы в каждом скользящем окне.
    *   Для произвольного нечетного размера окна: Используется `ArrayPool<double>` для временного буфера, копирование данных окна в буфер, сортировка (`Array.Sort`) и выбор медианы (элемент посередине отсортированного буфера).
    *   Алгоритм корректно обрабатывает краевые эффекты (когда окно выходит за границы сигнала).

## Инструкции по запуску

1.  Убедитесь, что у вас установлен .NET 9 SDK.
2.  Склонируйте репозиторий.
3.  В командной строке перейдите в директорию проекта `SignalGeneratorApp`.
4.  Выполните команду `dotnet run`.
5.  **ВАЖНО:** Если база данных `signals.db` с примерами данных находится в корне проекта, **скопируйте её в папку `bin/Debug/net9.0-windows/`** перед запуском, чтобы примеры были доступны в истории.

## Структура решения

*   `SignalGeneratorApp.csproj`: Основной проект приложения.
*   `SignalGeneratorApp.Tests.csproj`: Проект с модульными тестами.
*   `App.xaml/.cs`: Точка входа приложения, настройка DI.
*   `MainWindow.xaml/.cs`: Главное окно приложения.
*   `Models/`: Модели данных (Signal, SignalPoint, SignalParameter и др.).
*   `ViewModels/`: ViewModel-ы, реализующие логику представления.
*   `Views/`: Представления (XAML).
*   `Services/`: Сервисы бизнес-логики (генерация, обработка, работа с БД, история).
*   `Repositories/`: Репозитории для работы с БД.
*   `Visualizers/`: Компоненты визуализации.
*   `Converters/`: Конвертеры данных для WPF.
*   `Validators/`: Валидаторы моделей.
*   `Extensions/`: Вспомогательные расширения.
*   `appsettings.json`: Файл конфигурации (например, строка подключения к БД).

## Возможные улучшения / Нереализованные функции

*   **Наложение нескольких сигналов на один график:** Возможность выбора нескольких сигналов из истории и отображения их на одном графике.
*   **Применение математических операций к сигналу:** Возможность выполнения операций (например, инверсия, смещение, умножение на константу) над загруженным или сгенерированным сигналом.
*   **Логирование:** Внедрение системы логирования (например, через Microsoft.Extensions.Logging) для отслеживания ошибок, отменённых операций и важных событий в приложении.
*   **Пользовательские настройки:** Возможность настройки внешнего вида графика (цвета, толщина линии), поведения интерфейса, параметров генерации по умолчанию.
*   **Экспорт данных:** Возможность экспорта точек сигнала в файл (например, CSV).
*   **Отмена длительных операций:** Более широкое применение `CancellationToken` и визуальных элементов (например, ProgressRing) для отображения прогресса и возможности отмены длительных операций, таких как фильтрация или генерация с большим количеством точек.
*   **Дописать тесты:** Расширить покрытие unit-тестами для других компонентов приложения, таких как ViewModel, сервисы работы с БД, валидаторы, логика визуализации и обработки сигналов (например, медианный фильтр, экспорт в PNG).